<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Museum Lichtenberg: Orte des Widerstands</title>
    
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #050505;
            --text-main: #ffffff;
            --c-erinnerung: #D4AF37;
            --c-gedenken: #A0A0A0;
            --c-widerstand: #00E676;
            --c-heute: #FF3D00;
            --c-path: #00FFFF;

            --font-head: 'Space Grotesk', sans-serif;
            --font-body: 'Inter', sans-serif;
            
            --sidebar-width: 500px;
        }

        body { margin: 0; padding: 0; background: var(--bg-color); color: var(--text-main); font-family: var(--font-body); overflow: hidden; }

        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 1; }

        /* --- MINI SCANNER WINDOW --- */
        #mini-scanner-wrapper {
            position: absolute; 
            top: 170px; left: 30px; 
            width: 200px; height: 150px;
            background: #000;
            border: 2px solid var(--c-widerstand);
            border-radius: 8px;
            overflow: hidden;
            z-index: 20; 
            pointer-events: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.9);
            display: none; /* Hidden by default */
            flex-direction: column;
        }
        
        #reader { width: 100%; height: 100%; object-fit: cover; }

        /* RESULT OVERLAY */
        #scan-result-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none; 
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 22; text-align: center;
        }
        
        .result-btn {
            background: var(--c-widerstand); color: black; border: none;
            padding: 10px 15px; border-radius: 4px; font-weight: bold;
            font-family: var(--font-head); text-transform: uppercase; font-size: 0.9rem;
            cursor: pointer; margin-top: 5px; 
            box-shadow: 0 0 15px var(--c-widerstand);
            animation: pulse 1s infinite;
        }
        .found-text { font-size: 0.7rem; color: #fff; margin-bottom: 5px; }
        
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* CLOSE BUTTON FOR SCANNER */
        #close-scanner {
            position: absolute; top: 5px; right: 5px;
            background: rgba(0,0,0,0.5); color: white; border: none;
            width: 24px; height: 24px; border-radius: 50%; cursor: pointer; z-index: 30;
        }

        /* TRIGGER BUTTON */
        #btn-activate-scan {
            position: absolute; top: 160px; left: 30px; pointer-events: auto;
            background: rgba(0,0,0,0.8); color: var(--c-widerstand);
            border: 2px solid var(--c-widerstand); border-radius: 50px;
            padding: 12px 25px; cursor: pointer;
            font-family: var(--font-head); font-weight: bold; font-size: 1rem; letter-spacing: 1px;
            display: flex; align-items: center; gap: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: all 0.2s;
        }

        /* START OVERLAY */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(5,5,5,0.98); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
        }
        .start-btn {
            font-family: var(--font-head); font-size: 1.5rem;
            background: var(--c-widerstand); color: black; border: none;
            padding: 20px 50px; border-radius: 50px; cursor: pointer;
            text-transform: uppercase; font-weight: bold; letter-spacing: 2px;
            box-shadow: 0 0 30px var(--c-widerstand);
        }

        /* UI ELEMENTS (Header, Sidebar, etc) */
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .vignette-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 5; background: radial-gradient(circle at center, transparent 35%, rgba(0,0,0,0.7) 60%, rgba(0,0,0,1) 90%); }
        header { position: absolute; top: 30px; left: 30px; pointer-events: auto; text-shadow: 0 0 10px rgba(0,0,0,0.8); }
        .museum-label { font-family: var(--font-head); font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; color: #aaa; margin-bottom: 5px; font-weight: 500; border-left: 3px solid var(--c-widerstand); padding-left: 10px; }
        h1 { font-family: var(--font-head); font-size: 3rem; margin: 0; line-height: 0.9; font-weight: 700; color: white; letter-spacing: -1px; }
        
        #timeline-ui { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 80%; max-width: 900px; min-width: 320px; pointer-events: auto; text-align: center; background: rgba(10, 10, 10, 0.85); padding: 15px 40px; border-radius: 40px; border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(8px); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #year-display { font-family: var(--font-head); font-size: 2.5rem; font-weight: 700; display: block; margin-bottom: 5px; line-height: 1; color: white; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; background: #444; border-radius: 2px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%; background: #fff; border: 2px solid #000; margin-top: -8px; transition: transform 0.1s; }
        .ticks { display: flex; justify-content: space-between; width: 100%; margin-top: 10px; font-size: 0.8rem; color: #ccc; text-transform: uppercase; letter-spacing: 1px; font-family: var(--font-head); }
        .ticks span { text-align: center; flex: 1; }
        .ticks span:first-child { text-align: left; }
        .ticks span:last-child { text-align: right; }

        #sidebar { position: absolute; right: 0; top: 0; bottom: 0; width: var(--sidebar-width); background: #080808; border-left: 1px solid #333; z-index: 60; transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1); overflow-y: auto; pointer-events: auto; display: flex; flex-direction: column; box-shadow: -20px 0 50px rgba(0,0,0,0.8); }
        #sidebar.open { transform: translateX(0); }
        .close-area { position: sticky; top: 0; width: 100%; height: 70px; z-index: 50; display: flex; justify-content: flex-end; align-items: center; padding-right: 25px; background: linear-gradient(to bottom, rgba(8,8,8,1) 50%, rgba(8,8,8,0)); }
        .close-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; width: 44px; height: 44px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        
        .sidebar-content { padding: 40px; padding-top: 0; }
        .hero-img { width: 100%; height: 300px; object-fit: cover; border-bottom: 4px solid #333; margin-bottom: 25px; }
        .cat-tag { font-family: var(--font-head); font-size: 0.7rem; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; display: inline-block; padding: 4px 8px; border: 1px solid #444; color: #fff; }
        h2 { font-family: var(--font-head); font-size: 2.2rem; line-height: 1.1; margin: 0 0 25px 0; font-weight: 700; color: white; }
        .article { font-size: 1.05rem; line-height: 1.7; color: #ccc; font-weight: 300; margin-bottom: 40px; }
        .article h3 { color: white; font-family: var(--font-head); font-size: 1.2rem; margin-top: 30px; margin-bottom: 10px; font-weight: 500; border-left: 3px solid var(--c-path); padding-left: 10px; }
        .source { font-size: 0.75rem; color: #666; border-top: 1px solid #222; padding-top: 20px; font-style: italic; }
        .locked-view { height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 40px; color: #555; }
        .locked-icon { font-size: 4rem; margin-bottom: 20px; opacity: 0.5; }

        @media (max-width: 1024px) {
            :root { --sidebar-width: 100%; }
            #timeline-ui { width: 90%; bottom: 20px; padding: 15px 20px; }
            .sidebar-content { padding: 25px; }
            #mini-scanner-wrapper { top: 120px; left: 20px; width: 220px; height: 160px; }
            #btn-activate-scan { top: 120px; left: 20px; }
        }

        .mapboxgl-popup-content { background: #000; color: #fff; border: 1px solid #444; font-family: var(--font-body); padding: 10px 14px; }
        .mapboxgl-popup-close-button { display: none; }

    </style>
</head>
<body class="p-1933">

    <div id="start-overlay">
        <h1 style="margin-bottom: 30px; color:white;">Museum Lichtenberg</h1>
        <button class="start-btn" onclick="startApp()">Ausstellung Starten</button>
        <p style="color:#aaa; margin-top:20px; font-family:'Inter';">Bitte Kamera-Zugriff zulassen.</p>
    </div>

    <div id="map"></div>
    <div class="vignette-overlay"></div>

    <div id="ui-layer">
        <header>
            <div class="museum-label">Museum Lichtenberg</div>
            <h1>Orte des<br>Widerstands</h1>
        </header>

        <button id="btn-activate-scan" onclick="toggleScanner()">
            <span>ðŸ“·</span> SCAN QR
        </button>

        <div id="mini-scanner-wrapper">
            <button id="close-scanner" onclick="toggleScanner()">âœ•</button>
            <div id="reader"></div>
            
            <div id="scan-result-layer">
                <div class="found-text">ERKANNT</div>
                <button id="scan-action-btn" class="result-btn">EVENT ANZEIGEN âž”</button>
            </div>
        </div>

        <div id="timeline-ui">
            <span id="year-display">1933</span>
            <input type="range" id="year-slider" min="1933" max="2026" value="1933" step="1">
            <div class="ticks">
                <span>1933</span><span>1990</span><span>2000</span><span>Heute</span>
            </div>
        </div>
    </div>

    <div id="sidebar">
        <div class="close-area">
            <button class="close-btn" onclick="closeSidebar()">&times;</button>
        </div>
        <div id="sidebar-content"></div>
    </div>

    <script>
        // ------------------------------------------------------------------
        // 1. DATA
        // ------------------------------------------------------------------
        mapboxgl.accessToken = 'pk.eyJ1IjoiaWxpYXNtZXJhYmloYSIsImEiOiJjbWw5bHNnc3YwM3ZwM2RxdXU5YjdiN201In0.CTiUlh-M4fTkIda8EtP4Yg'; 

        const geoData = {
            'type': 'FeatureCollection',
            'features': [
                { 'type': 'Feature', 'properties': { 'id': 'h1', 'category': 'erinnerung', 'title': 'Der Blutbaum am Loeperplatz', 'year': 1934, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Gedenkstein_Loeperplatz_%28Berlin-Lichtenberg%29.jpg/800px-Gedenkstein_Loeperplatz_%28Berlin-Lichtenberg%29.jpg', 'description': '...', 'source': 'GedenkstÃ¤tte Deutscher Widerstand' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4800, 52.5135] } },
                { 'type': 'Feature', 'properties': { 'id': 'h2', 'category': 'erinnerung', 'title': 'Zwangsarbeiterlager Rummelsburg', 'year': 1941, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Gedenktafel_Hauptstr_8_%28Rumm%29_Arbeitserziehungslager.jpg/800px-Gedenktafel_Hauptstr_8_%28Rumm%29_Arbeitserziehungslager.jpg', 'description': '...', 'source': 'Museum Lichtenberg' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4850, 52.4950] } },
                { 'type': 'Feature', 'properties': { 'id': 'h3', 'category': 'erinnerung', 'title': 'Erna Lugebiel: Stille Heldin', 'year': 1943, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Stadthaus_Lichtenberg_Berlin.jpg/800px-Stadthaus_Lichtenberg_Berlin.jpg', 'description': '...', 'source': 'GedenkstÃ¤tte Stille Helden' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4790, 52.5220] } },
                { 'type': 'Feature', 'properties': { 'id': 'w1', 'category': 'widerstand', 'title': 'RÃ¤umung der Mainzer StraÃŸe', 'year': 1990, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6d/Mainzer_Stra%C3%9Fe_Berlin-Friedrichshain_1990.jpg/800px-Mainzer_Stra%C3%9Fe_Berlin-Friedrichshain_1990.jpg', 'description': '...', 'source': 'Zeitzeugenarchiv Berlin' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4620, 52.5120] } },
                { 'type': 'Feature', 'properties': { 'id': 'g1', 'category': 'gedenken', 'title': 'Der Mord an Silvio Meier', 'year': 1992, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Gedenktafel_Silvio_Meier_%28U-Bhf_Samariterstra%C3%9Fe%29.jpg/800px-Gedenktafel_Silvio_Meier_%28U-Bhf_Samariterstra%C3%9Fe%29.jpg', 'description': '...', 'source': 'Amadeu Antonio Stiftung' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4650, 52.5140] } },
                { 'type': 'Feature', 'properties': { 'id': 'g2', 'category': 'gedenken', 'title': 'Die "Angstzone" WeitlingstraÃŸe', 'year': 1995, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/36/Berlin%2C_Lichtenberg%2C_Weitlingstrasse.jpg/800px-Berlin%2C_Lichtenberg%2C_Weitlingstrasse.jpg', 'description': '...', 'source': 'Licht-Blicke Podcast' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4985, 52.5075] } },
                { 'type': 'Feature', 'properties': { 'id': 'g3', 'category': 'gedenken', 'title': 'Gedenken an Eugeniu Botnari', 'year': 2016, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/f8/Bahnhof_Berlin-Lichtenberg_Empfangsgeb%C3%A4ude_20160808_1.jpg/800px-Bahnhof_Berlin-Lichtenberg_Empfangsgeb%C3%A4ude_20160808_1.jpg', 'description': '...', 'source': 'Initiative Gedenken an Eugeniu Botnari' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4970, 52.5100] } },
                { 'type': 'Feature', 'properties': { 'id': 'cur1', 'category': 'heute', 'title': 'LOCKED: Angriff am Ostkreuz', 'year': 2024, 'locked': true, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/cf/Bahnhof_Berlin_Ostkreuz_Eingang_Sonntagsstr.jpg/800px-Bahnhof_Berlin_Ostkreuz_Eingang_Sonntagsstr.jpg', 'description': '...', 'source': 'Berliner Register 2024' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4693, 52.5030] } },
                { 'type': 'Feature', 'properties': { 'id': 'cur2', 'category': 'heute', 'title': 'LOCKED: Code 1161 an Schulen', 'year': 2025, 'locked': true, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Berlin_Wartenberg_Woldegker_Stra%C3%9Fe_Grundschule_im_Gr%C3%BCnen_01.jpg/800px-Berlin_Wartenberg_Woldegker_Stra%C3%9Fe_Grundschule_im_Gr%C3%BCnen_01.jpg', 'description': '...', 'source': 'Lichtenberger Register' }, 'geometry': { 'type': 'Point', 'coordinates': [13.5000, 52.5400] } },
                { 'type': 'Feature', 'properties': { 'id': 'cur3', 'category': 'heute', 'title': 'LOCKED: Angriff auf Jugendclub', 'year': 2025, 'locked': true, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/1/1a/Berlin_Wartenberg_Woldegker_Stra%C3%9Fe_Grundschule_im_Gr%C3%BCnen_01.jpg/800px-Berlin_Wartenberg_Woldegker_Stra%C3%9Fe_Grundschule_im_Gr%C3%BCnen_01.jpg', 'description': '...', 'source': 'Polizei Berlin' }, 'geometry': { 'type': 'Point', 'coordinates': [13.5200, 52.4900] } },
                { 'type': 'Feature', 'properties': { 'id': 'cur4', 'category': 'widerstand', 'title': 'LOCKED: BÃ¼ndnis Bunter Wind', 'year': 2026, 'locked': true, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2e/Rathaus_Lichtenberg.jpg/800px-Rathaus_Lichtenberg.jpg', 'description': '...', 'source': 'BÃ¼ndnis fÃ¼r Demokratie' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4815, 52.5160] } },
                { 'type': 'Feature', 'properties': { 'id': 'cur5', 'category': 'widerstand', 'title': 'LOCKED: Licht-Blicke', 'year': 2026, 'locked': true, 'image': 'https://upload.wikimedia.org/wikipedia/commons/thumb/e/e5/Gudrunstra%C3%9Fe_Berlin-Lichtenberg.jpg/800px-Gudrunstra%C3%9Fe_Berlin-Lichtenberg.jpg', 'description': '...', 'source': 'www.licht-blicke.org' }, 'geometry': { 'type': 'Point', 'coordinates': [13.4880, 52.5120] } }
            ]
        };

        let state = {
            discovered: [],
            required: 3,
            unlocked: false,
            scannerObj: null,
            audioCtx: null
        };

        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/dark-v11',
            center: [13.485, 52.51],
            zoom: 12.5,
            pitch: 45,
            bearing: -10,
            maxBounds: [[13.3, 52.4], [13.7, 52.6]] 
        });

        // ------------------------------------------------------------------
        // 2. APP LOGIC
        // ------------------------------------------------------------------
        function startApp() {
            document.getElementById('start-overlay').style.display = 'none';
            state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            state.audioCtx.resume();
        }

        function toggleScanner() {
            const wrapper = document.getElementById('mini-scanner-wrapper');
            const btn = document.getElementById('btn-activate-scan');
            
            if (wrapper.style.display === 'flex') {
                // STOP
                if(state.scannerObj) {
                    state.scannerObj.stop().then(() => state.scannerObj.clear());
                }
                wrapper.style.display = 'none';
                btn.style.display = 'flex';
            } else {
                // START
                btn.style.display = 'none';
                wrapper.style.display = 'flex';
                document.getElementById('scan-result-layer').style.display = 'none';
                
                if(!state.scannerObj) state.scannerObj = new Html5Qrcode("reader");
                state.scannerObj.start(
                    { facingMode: "environment" }, 
                    { fps: 10, qrbox: 130 },
                    onScanSuccess
                ).catch(err => {
                    alert("Kamerafehler: " + err);
                    wrapper.style.display = 'none';
                    btn.style.display = 'flex';
                });
            }
        }

        function onScanSuccess(decodedText) {
            // 1. Try Extract ID
            let eventId = decodedText;
            try {
                const url = new URL(decodedText);
                const param = url.searchParams.get("event");
                if(param) eventId = param;
            } catch(e) {}

            // 2. Check DB
            const target = geoData.features.find(f => f.properties.id === eventId);
            
            if (target) {
                // 3. Pause & Show Button
                if(state.audioCtx) {
                    const osc = state.audioCtx.createOscillator();
                    const gain = state.audioCtx.createGain();
                    osc.connect(gain); gain.connect(state.audioCtx.destination);
                    osc.frequency.value = 1200; gain.gain.value = 0.1;
                    osc.start(); setTimeout(() => osc.stop(), 100);
                }
                
                state.scannerObj.pause();
                
                const overlay = document.getElementById('scan-result-layer');
                const btn = document.getElementById('scan-action-btn');
                overlay.style.display = 'flex';
                
                btn.onclick = () => {
                    toggleScanner(); // Close window
                    
                    if (!state.discovered.includes(eventId)) {
                        state.discovered.push(eventId);
                        // Update Progress Visuals (Simplified for this snippet)
                    }
                    if (target.properties.locked) unlockAll();
                    else updateMap(target.properties.year);
                    
                    handleMarker(target.properties, target.geometry.coordinates, true);
                };
            }
        }

        // ------------------------------------------------------------------
        // 3. MAP LOGIC (Condensed)
        // ------------------------------------------------------------------
        map.on('load', () => {
            map.addLayer({ 'id': '3d-buildings', 'source': 'composite', 'source-layer': 'building', 'filter': ['==', 'extrude', 'true'], 'type': 'fill-extrusion', 'paint': { 'fill-extrusion-color': '#222', 'fill-extrusion-height': ['get', 'height'] } }, 'waterway-label');
            map.addSource('markers', { 'type': 'geojson', 'data': geoData });
            map.addLayer({ 'id': 'marker-glow', 'type': 'circle', 'source': 'markers', 'paint': { 'circle-radius': 40, 'circle-color': ['match', ['get', 'category'], 'erinnerung', '#D4AF37', 'gedenken', '#A0A0A0', 'widerstand', '#00E676', 'heute', '#FF3D00', '#fff'], 'circle-opacity': 0.3 } });
            map.addLayer({ 'id': 'marker-core', 'type': 'circle', 'source': 'markers', 'paint': { 'circle-radius': 10, 'circle-color': '#fff' } });
            map.on('click', 'marker-core', (e) => handleMarker(e.features[0].properties, e.features[0].geometry.coordinates));
            
            // Check Deep Link on Load
            const urlParams = new URLSearchParams(window.location.search);
            const startEvent = urlParams.get('event');
            if(startEvent) {
                document.getElementById('start-overlay').style.display = 'none';
                const t = geoData.features.find(f => f.properties.id === startEvent);
                if(t) handleMarker(t.properties, t.geometry.coordinates, true);
            }
            updateMap(1933);
        });

        function handleMarker(props, coords, force = false) {
            if (props.locked && !state.unlocked && !force) { openSidebarLocked(); return; }
            if (!state.discovered.includes(props.id) && !props.locked) state.discovered.push(props.id);
            map.flyTo({ center: coords, zoom: 16, pitch: 60, offset: [0, -200], speed: 0.8 });
            openSidebar(props);
        }

        function unlockAll() {
            state.unlocked = true;
            document.getElementById('year-slider').value = 2026;
            document.getElementById('year-display').innerText = 2026;
            updateMap(2026);
        }

        const slider = document.getElementById('year-slider');
        slider.addEventListener('input', (e) => {
            document.getElementById('year-display').innerText = e.target.value;
            updateMap(parseInt(e.target.value));
        });

        function updateMap(year) {
            const filter = ['<=', ['get', 'year'], year];
            map.setFilter('marker-glow', filter);
            map.setFilter('marker-core', filter);
        }

        function openSidebar(data) {
            const content = document.getElementById('sidebar-content');
            const colors = { 'erinnerung': '#D4AF37', 'gedenken': '#A0A0A0', 'widerstand': '#00E676', 'heute': '#FF3D00' };
            content.innerHTML = `<img src="${data.image}" class="hero-img"><div class="sidebar-content"><span class="cat-tag" style="border-color:${colors[data.category]}; color:${colors[data.category]}">${data.category.toUpperCase()}</span><h2>${data.title}</h2><div class="article">${data.description}</div><div class="source">Quelle: ${data.source}</div></div>`;
            document.getElementById('sidebar').classList.add('open');
        }

        function openSidebarLocked() {
            document.getElementById('sidebar-content').innerHTML = `<div class="locked-view"><div class="locked-icon">ðŸ”’</div><h2 style="color:#FF3D00">DATEN VERSCHLÃœSSELT</h2><p>Erforschen Sie erst die Geschichte.</p></div>`;
            document.getElementById('sidebar').classList.add('open');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            map.easeTo({ offset: [0, 0] });
        }
    </script>
</body>
</html>
